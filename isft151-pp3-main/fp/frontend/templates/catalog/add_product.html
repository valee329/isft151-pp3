<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agregar Producto</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#ffffff;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:50px 20px;color:#17353a;}
.container{width:100%;max-width:860px;background:#fff;border:1px solid #e6f3ea;border-radius:14px;box-shadow:0 8px 24px rgba(16,24,40,.06);padding:40px;}
h1{margin:0 0 18px;color:#0f2e1f;}
label{display:block;margin:10px 0 6px;color:#0f2e1f;font-weight:600;}
input, textarea{width:100%;padding:12px;border:1px solid #cfe9d8;border-radius:10px;background:#fff;color:#17353a;font-size:.95rem;}
input:focus, textarea:focus{outline:2px solid #bbf7d0;border-color:#86efac;}
.preview-block{display:flex;gap:16px;align-items:center;margin-bottom:16px;}
.product-preview{width:140px;aspect-ratio:1/1;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#f6fef8;border:2px solid #bbf7d0;overflow:hidden;}
.product-preview img{width:100%;height:100%;object-fit:cover;}
.actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:24px;}
button{background:#22c55e;border:none;color:#ffffff;padding:12px 18px;font-size:.95rem;font-weight:700;border-radius:10px;cursor:pointer;}
button:hover{background:#1ea34f}
a.secondary{background:transparent;color:#1ea34f;text-decoration:none;padding:12px 18px;font-size:.9rem;font-weight:700;border-radius:10px;border:1px solid #86efac;}
a.secondary:hover{background:#f0fdf4}
.flash{background:#fff8f6;border:1px solid #ffd1c7;padding:10px 14px;border-radius:12px;font-size:.85rem;color:#b42318;margin-bottom:16px;}
</style>
</head>
<body>
<div class="container">
    <h1>Agregar Nuevo Producto</h1>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for m in messages %}
                <div class="flash">{{ m }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST">
        <div class="preview-block">
            <div class="product-preview" id="imagePreview">?</div>
            <div style="flex:1">
                <label for="image_url">URL de la Imagen</label>
                <input type="url" id="image_url" name="image_url" placeholder="https://...">
            </div>
        </div>

        <div>
            <label for="name">Nombre del Producto</label>
            <input type="text" id="name" name="name" required>
        </div>

        <div>
            <label for="description">Descripción</label>
            <textarea id="description" name="description" rows="3"></textarea>
        </div>

        <div>
            <label for="price">Precio</label>
            <input type="number" id="price" name="price" step="0.01" required>
        </div>

        <div class="actions">
            <button type="submit">Agregar Producto</button>
            <a href="{{ url_for('catalog.view_catalog', vendor_id=current_user.id) }}" class="secondary">Cancelar</a>
        </div>
    </form>
</div>

<script>
const urlInput = document.getElementById('image_url');
const preview = document.getElementById('imagePreview');

function updatePreview(){
    const v = (urlInput.value || '').trim();
    if(!v){
        const img = preview.querySelector('img');
        if(img) img.remove();
        preview.textContent='?';
        return;
    }
    let img = preview.querySelector('img');
    if(!img){
        preview.textContent='';
        img = document.createElement('img');
        preview.appendChild(img);
    }
    img.src = v;
    img.onerror = () => {
        if(img) img.remove();
        preview.textContent='✕';
    };
}

urlInput.addEventListener('input', ()=>{
    clearTimeout(urlInput._t);
    urlInput._t = setTimeout(updatePreview, 280);
});
</script>
</body>
</html>