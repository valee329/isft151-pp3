<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Complete Profile</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#ffffff;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:50px 20px;color:#17353a;}
.container{width:100%;max-width:860px;background:#fff;border:1px solid #e6f3ea;border-radius:14px;box-shadow:0 8px 24px rgba(16,24,40,.06);padding:40px;}
h1{margin:0 0 18px;color:#0f2e1f;}
.preview-block{display:flex;gap:16px;align-items:center;margin-bottom:16px;}
.avatar-preview{width:140px;aspect-ratio:1/1;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#f6fef8;border:2px solid #bbf7d0;color:#16a34a;font-size:2.4rem;font-weight:700;overflow:hidden;}
.avatar-preview img{width:100%;height:100%;object-fit:cover;display:block;}
label{display:block;margin:10px 0 6px;color:#0f2e1f;font-weight:600;}
input, textarea{width:100%;padding:12px;border:1px solid #cfe9d8;border-radius:10px;background:#fff;color:#17353a;font-size:.95rem;}
input:focus, textarea:focus{outline:2px solid #bbf7d0;border-color:#86efac;}
.hint{font-size:.75rem;color:#587a68;margin-top:4px;}
.flash{background:#fff8f6;border:1px solid #ffd1c7;padding:10px 14px;border-radius:12px;font-size:.85rem;color:#b42318;}
.actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px;}
button{background:#22c55e;border:none;color:#ffffff;padding:12px 18px;font-size:.95rem;font-weight:700;border-radius:10px;cursor:pointer;box-shadow:0 6px 16px rgba(34,197,94,.25);}
button:hover{background:#1ea34f}
a.secondary{background:transparent;color:#1ea34f;text-decoration:none;padding:12px 18px;font-size:.9rem;font-weight:700;border-radius:10px;border:1px solid #86efac;}
a.secondary:hover{background:#f0fdf4}
@media (max-width:620px){.container{padding:28px}.avatar-preview{width:110px;font-size:2rem}}
</style>
</head>
<body>
<div class="container">
  <h1>Complete Your Profile</h1>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for m in messages %}
        <div class="flash">{{ m }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="POST">
    <div class="preview-block">
      <div class="avatar-preview" id="avatarPreview">
        {% if user and user.avatar_url %}
          <img src="{{ user.avatar_url }}" alt="Current avatar">
        {% else %}
          ?
        {% endif %}
      </div>
      <div style="flex:1;min-width:220px;">
        <label for="avatar_url">Avatar Image URL</label>
        <input id="avatar_url" name="avatar_url" placeholder="https://..." value="{{ user.avatar_url if user and user.avatar_url }}">
        <div class="hint">Paste an image URL to preview.</div>
      </div>
    </div>

    <div>
      <label for="bio">Short Bio</label>
      <textarea id="bio" name="bio" placeholder="Tell people about your food, style, experience...">{{ user.bio if user and user.bio }}</textarea>
    </div>

    <div>
      <label for="location">Location</label>
      <input id="location" name="location" placeholder="City / Area" value="{{ user.location if user and user.location }}">
    </div>

    <div class="actions">
      <button type="submit">Save Profile</button>
      <a href="/feed" class="secondary">Skip</a>
    </div>
  </form>
</div>
<script>
const urlInput = document.getElementById('avatar_url');
const preview = document.getElementById('avatarPreview');

function updatePreview(){
  const v = (urlInput.value || '').trim();
  if(!v){
    const img = preview.querySelector('img');
    if(img) img.remove();
    preview.textContent='?';
    return;
  }
  let img = preview.querySelector('img');
  if(!img){
    preview.textContent='';
    img = document.createElement('img');
    preview.appendChild(img);
  }
  img.src = v;
  img.onerror = () => {
    if(img) img.remove();
    preview.textContent='âœ•';
  };
}

urlInput.addEventListener('input', ()=>{
  clearTimeout(urlInput._t);
  urlInput._t = setTimeout(updatePreview, 280);
});
</script>
</body>
</html>